parameters:
  workingDirectory:

steps:
- script: |
    # Display command output and fail immediately on any errors
    set -e -x

    # Update package version to build number
    sed -i 's/[TASK_VERSION]/$(Build.BuildNumber)/g' package.json

    # Install NPM Packages
    npm install
    
    # Build typescript
    tsc --build
    
    # Ensure the destination path exists
    mkdir -p $(Build.StagingDirectory)/Tasks/

    # Copy all task files to the staging output path
    rsync -avr . \
      --exclude=./* \
      --include=./node_modules \
      --include=./package.json \
      --include=./package-lock.json \
      --include=./task.json \
      $(Build.StagingDirectory)/Tasks/  
  workingDirectory: ${{ parameters.workingDirectory }}
  displayName: Build, test and package the Task
